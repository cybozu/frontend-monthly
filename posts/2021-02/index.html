<!DOCTYPE html><html lang="ja"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width"><meta name="description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"><meta name="twitter:card" content="summary"><meta name="twitter:creator" content="Cybozu Frontend Expert Team"><meta name="twitter:title" content="Cybozu Frontend Monthly #8"><meta name="twitter:description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"><meta property="og:title" content="Cybozu Frontend Monthly #8"><meta property="og:description" content="サイボウズのフロントエンドエキスパートチームが月イチでお届けするフロントエンド情報"><meta property="og:type" content="website"><meta property="og:image" content="https://cybozu.github.io/frontend-monthly/img/header.png"><link rel="icon" type="image/png" sizes="32x32" href="/frontend-monthly/icons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/frontend-monthly/icons/favicon-16x16.png"><meta name="generator" content="Astro v3.0.13"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.21.0/themes/prism.min.css"><title>Cybozu Frontend Monthly #8</title><link rel="stylesheet" href="/frontend-monthly/_astro/_slug_.884b4dcf.css" />
<style>:root{--accent: 124, 58, 237;--accent-gradient: linear-gradient( 45deg, rgb(var(--accent)), #da62c4 30%, white 60% )}html{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji}body{margin:0;border-top:4px solid #64bdd4}code{font-family:Menlo,Monaco,Lucida Console,Liberation Mono,DejaVu Sans Mono,Bitstream Vera Sans Mono,Courier New,monospace}.main{box-sizing:border-box;min-width:200px;max-width:980px;width:100%;margin:0 auto;padding:15px 45px;color:#24292e}@media (max-width: 767px){.main{padding:12px;font-size:14px}.main .markdown-body{font-size:14px}.main .markdown-body h1{font-size:1.55em;margin-bottom:.25em;margin-top:.5em}.main .markdown-body h2{font-size:1.3em;margin-bottom:.25em;margin-top:.5em}.main .markdown-body h3{font-size:1.1em;margin-bottom:.25em;margin-top:.5em}.main .markdown-body img{max-width:100%;height:auto}.main hr{margin:12px 0}}.footer{background-color:#31424e;text-align:center;color:#f8f8ff;font-size:.75em;padding:5px 0;line-height:1.5}.footer a{color:inherit;text-decoration:none}.markdown-body li>*:first-child{padding-top:8px;padding-bottom:8px}.markdown-body li>ul{margin-top:8px}.markdown-body li+li{margin:8px 0}
</style></head><body><main class="main"><h1 class="post-title" data-astro-cid-gjtny2mx>Cybozu Frontend Monthly #8</h1><div class="markdown-body" data-astro-cid-gjtny2mx><img src="/frontend-monthly/_astro/header.dc458974_ZIMvDY.webp" alt="タイトル画像" data-astro-cid-grpv5qb7 width="660" height="270" loading="lazy" decoding="async"><h2 data-astro-cid-grpv5qb7>イベント概要</h2><p data-astro-cid-grpv5qb7><strong data-astro-cid-grpv5qb7>サイボウズフロントエンドマンスリー</strong>
は、サイボウズ社内で行っているフロントエンド情報共有会「フロントエンドウィークリー」の公開版です。
</p><p data-astro-cid-grpv5qb7>
その月に気になったフロントエンドの情報を、サイボウズのフロントエンドエキスパートチームのメンバーが共有していきます。
</p><p data-astro-cid-grpv5qb7><strong data-astro-cid-grpv5qb7>
このイベントのハッシュタグは <a href="https://twitter.com/search?q=%23%E3%82%B5%E3%82%A4%E3%83%9C%E3%82%A6%E3%82%BA%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%83%9E%E3%83%B3%E3%82%B9%E3%83%AA%E3%83%BC" target="_blank" rel="noopener noreferrer" data-astro-cid-grpv5qb7>
#サイボウズフロントエンドマンスリー
</a> 
です。
</strong></p><div class="note" data-astro-cid-grpv5qb7><h3 data-astro-cid-grpv5qb7>※フロントエンドウィークリーとは</h3><p data-astro-cid-grpv5qb7>
毎週火曜の 17:00 〜 18:00
    で社内向けに行っているフロントエンドの気になる記事を紹介する会です。2016年3月15日から行われています。
<br data-astro-cid-grpv5qb7>
ハッシュタグ <a href="https://twitter.com/search?q=%23%E3%82%B5%E3%82%A4%E3%83%9C%E3%82%A6%E3%82%BA%E3%83%95%E3%83%AD%E3%83%B3%E3%83%88%E3%82%A8%E3%83%B3%E3%83%89%E3%82%A6%E3%82%A3%E3%83%BC%E3%82%AF%E3%83%AA%E3%83%BC" target="_blank" rel="noopener noreferrer" data-astro-cid-grpv5qb7>
#サイボウズフロントエンドウィークリー
</a> 
で実況しています。
</p><p data-astro-cid-grpv5qb7>
zennのpublicationにてウィークリーのまとめも投稿していますので、ぜひこちらもご覧ください。
<a href="https://zenn.dev/p/cybozu_frontend" target="_blank" rel="noopener noreferrer" data-astro-cid-grpv5qb7>
https://zenn.dev/p/cybozu_frontend
</a></p></div><h3 data-astro-cid-grpv5qb7>開催日</h3><p data-astro-cid-grpv5qb7>2021年03月02日</p><h3 data-astro-cid-grpv5qb7>イベントページ</h3><p data-astro-cid-grpv5qb7><a href="https://cybozu.connpass.com/event/205864/" target="_blank" rel="noopener noreferrer" data-astro-cid-grpv5qb7>https://cybozu.connpass.com/event/205864/</a></p><h3 data-astro-cid-grpv5qb7>配信URL</h3><p data-astro-cid-rqusjlqv><iframe title="https://www.youtube.com/embed/V-qsrYmUHjk" width="560" height="315" src="https://www.youtube.com/embed/V-qsrYmUHjk" style="border: 0;" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen class="embed" data-astro-cid-rqusjlqv></iframe><a href="https://www.youtube.com/watch?v=V-qsrYmUHjk" target="_blank" rel="noreferrer noopner" data-astro-cid-rqusjlqv>https://www.youtube.com/watch?v=V-qsrYmUHjk</a></p><h2 data-astro-cid-5i3bjwe7>メンバー</h2><div class="members" data-astro-cid-5i3bjwe7><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@koba04.jpg" class="thumbnail" alt="@koba04" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/koba04" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@koba04</a></div><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@pirosikick.jpg" class="thumbnail" alt="@pirosikick" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/pirosikick" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@pirosikick</a></div><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@__sakito__.jpg" class="thumbnail" alt="@__sakito__" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/__sakito__" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@__sakito__</a></div><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@shisama_.jpg" class="thumbnail" alt="@shisama_" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/shisama_" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@shisama_</a></div><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@nakajmg.jpg" class="thumbnail" alt="@nakajmg" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/nakajmg" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@nakajmg</a></div><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@b4h0_c4t.jpg" class="thumbnail" alt="@b4h0_c4t" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/b4h0_c4t" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@b4h0_c4t</a></div><div class="member" data-astro-cid-5i3bjwe7><img src="/frontend-monthly/img/@__sosukesuzuki.jpg" class="thumbnail" alt="@__sosukesuzuki" width="100" height="100" data-astro-cid-5i3bjwe7><a href="https://twitter.com/__sosukesuzuki" target="_blank" rel="noopener noreferrer" data-astro-cid-5i3bjwe7>@__sosukesuzuki</a></div></div><hr><h2>コンテンツ</h2><h3 id="smarthr-が-internet-explorer-サポート終了のお知らせを出した"><a href="https://smarthr.jp/other/22512">SmartHR が Internet Explorer サポート終了のお知らせを出した</a></h3>
<ul>
<li>共有者: nakajmg</li>
</ul>
<p>Microsoft が自身のサービスでの IE サポート終了予定を発表してから、国内のサービスからもそれに追従するようにサポート終了のお知らせが出てきています。</p>
<p>SmartHR に続いて<a href="https://support.biz.moneyforward.com/valuepack/news/important/20210226.html">Money Forward も IE サポート終了のお知らせを出しました</a>。</p>
<p>背景として挙げているのはセキュリティ面、Microsoft Edge の存在、そして<a href="https://blogs.windows.com/japan/2020/08/18/microsoft-365-apps-say-farewell-to-internet-explorer-11/">Microsoft 365 における IE11 サポート終了の発表</a>です。
また、両者ともに IE サポートの終了月を Microsoft 365 の IE サポート終了の日に合わせて 2021 年 8 月までとしています。</p>
<p>今後もこの動きに追従する発表が出てきそうです。</p>
<p>(※追記) <a href="https://engineer.crowdworks.jp/entry/2021/02/18/120000">クラウドワークスさんも同時期に IE を推奨ブラウザから外すお知らせを出しています</a>。</p>
<hr>
<h3 id="using-abortcontroller-as-an-alternative-for-removing-event-listeners--css-tricks"><a href="https://css-tricks.com/using-abortcontroller-as-an-alternative-for-removing-event-listeners/">Using AbortController as an Alternative for Removing Event Listeners | CSS-Tricks</a></h3>
<ul>
<li>共有者: pirosikick</li>
</ul>
<p>AbortController を jQuery の once 関数みたいな一度実行したら消えるタイプのイベントリスナーの代替として使う話。
<code>mousemove</code>と<code>mouseup</code>のイベントハンドラを、<code>mouseup</code>時に両方削除するようなユースケースの場合、AbortController を使うとスッキリ書ける。</p>
<hr>
<h3 id="introducing-env-a-better-way-to-read-environment-variables-in-javascript---human-who-codes"><a href="https://humanwhocodes.com/blog/2021/02/introducing-env-javascript-environment-variables/">Introducing Env: a better way to read environment variables in JavaScript - Human Who Codes</a></h3>
<ul>
<li>共有者: pirosikick</li>
</ul>
<p>ブラウザにサーバーサイドから環境変数を流し込む際に陥りがちな罠と、それを回避するために作られた<code>@humanwhocodes/env</code>について。
<code>env.required</code>や<code>env.exists</code>は Proxy で実装されている。
200 行くらいのシンプルなコードなので、<code>@humanwhocodes/env</code>を参考に自前で環境変数をラップしてアクセスする関数を作るのもよさそう。</p>
<hr>
<h3 id="maximally-optimizing-image-loading-for-the-web-in-2021"><a href="https://www.industrialempathy.com/posts/image-optimizations/">Maximally optimizing image loading for the web in 2021</a></h3>
<ul>
<li>共有者: b4h0_c4t</li>
</ul>
<p>Core Web Vitals を指標として画像読み込みの最適化する手法を簡単なコード付きで紹介しています。</p>
<p>半分ほどはブラウザが限定されていますが、手法として覚えておいても損はないかなという感じです。</p>
<ul>
<li>Responsive Layout
<ul>
<li>画像に width 、 height を設定する</li>
</ul>
</li>
<li>Lazy Rendering
<ul>
<li><code>content-visibility</code> を利用する</li>
</ul>
</li>
<li>AVIF
<ul>
<li>AVIF 形式の画像を利用する</li>
</ul>
</li>
<li>Load the right number of pixels
<ul>
<li>srcset で画面サイズ毎に適切な画像を読み込む</li>
</ul>
</li>
<li>Caching / Immutable URLs
<ul>
<li><code>cache-control</code> を利用する</li>
</ul>
</li>
<li>Lazy loading
<ul>
<li><code>loading="lazy"</code> 属性を追加する</li>
</ul>
</li>
<li>Asynchronous decoding
<ul>
<li><code>decoding="async"</code> 属性を追加する</li>
</ul>
</li>
<li>Blurry placeholder
<ul>
<li><code>background-image</code> に blurry image を差し込む</li>
</ul>
</li>
</ul>
<hr>
<h3 id="focus-visible-周りのブラウザ実装が進んだ">:focus-visible 周りのブラウザ実装が進んだ</h3>
<ul>
<li>共有者: sakito</li>
</ul>
<p>2 月に<code>:focus-visible</code>まわりでブラウザの動きが多かったのでまとめました。</p>
<h4 id="focus-visible-おさらい">:focus-visible おさらい</h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Web/CSS/:focus-visible">:focus-visible</a>は、タブ移動時のみ要素の<code>outline</code>が表示されるもの。<code>:focus</code>だと要素にクリック時やタブ移動時にフォーカスした際に<code>outline</code>が表示されるので、<code>outline</code>を消しがちだったがそれを避けることができる。</p>
<h4 id="chrome">Chrome</h4>
<p><a href="https://groups.google.com/a/chromium.org/g/blink-dev/c/gv69rSngHDY">Chrome で:focus-visible が UA style sheet のデフォルトに</a>なりました。</p>
<p>Chrome 86 から<code>:focus-visible</code>は使用できていたが、<code>UA style sheet</code>は<code>:forcus</code>だったので、下記のような記述が必要だった。</p>
<pre class="language-css"><code is:raw="" class="language-css"><span class="token selector">:focus:not(:focus-visible)</span> <span class="token punctuation">{</span>
  <span class="token property">outline</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>今回の変更で<code>:focus-visible</code>が UA style sheet のデフォルトになったので上記の記述は不要になる。</p>
<p>この変更は<a href="https://www.chromestatus.com/features/5658873031557120">Chrome 90</a>から入るぽいです。</p>
<h4 id="firefox">Firefox</h4>
<p><a href="https://developer.mozilla.org/en-US/docs/Mozilla/Firefox/Releases/85#css">Firefox 85 で:focus-visible が有効に</a>になりました。</p>
<p>いままで<code>:-moz-focusring</code>の疑似クラスを使用していたが、Firefox 85 で<code>:focus-visible</code>が実装されました。
FirefoxDevTools でスタイルの切り替えもできるようになっています。</p>
<h4 id="safari">Safari</h4>
<p><a href="https://blogs.igalia.com/mrego/2021/01/28/focus-visible-in-webkit-january-2021">Igalia が Open Prioritization を通して、WebKit に:focus-visible を実装協力</a></p>
<p>Igalia が<a href="https://www.igalia.com/open-prioritization/">Open Prioritization</a>というクラウドファンディングを通して、WebKit に<code>:focus-visible</code>を実装することになり、実装するために WPT のテストを実装したり、実装するにあたった課題を報告している記事です。</p>
<p>上記でも紹介している Chrome で:focus-visible が UA style sheet のデフォルトになっていない Issue を報告をしているのも Igalia の人なのですが、この PJ を通して発見されたものになります。</p>
<h3 id="littledanproposal-module-fragments"><a href="https://github.com/littledan/proposal-module-fragments">littledan/proposal-module-fragments</a></h3>
<ul>
<li>共有者: @sosukesuzuki</li>
</ul>
<p>3 月の TC39 ミーティングで <a href="https://github.com/littledan">@littledan</a> 氏から Module Fragments という Stage 0 のプロポーザルについて発表される予定です。</p>
<p>Module Fragments は次のようにインラインでモジュールを定義できる構文を導入します。</p>
<pre class="language-js"><code is:raw="" class="language-js">module <span class="token string">"#foo"</span> <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">let</span> foo <span class="token operator">=</span> <span class="token string">"foo"</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">import</span> <span class="token punctuation">{</span> foo <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">"#foo"</span><span class="token punctuation">;</span></code></pre>
<p>Module Fragments は主に webpack や Rollup、Parcel のようなモジュールバンドラーの出力として使われることを想定しています。</p>
<p>現在のモジュールバンドラーはいくつかの潜在的な問題を抱えています。</p>
<ul>
<li>ECMAScript Modules の仕様をエミュレートする必要があるため実装が複雑になる
<ul>
<li>しかも ECMAScript Modules に関連する仕様は増え続けるのでその度に追従するための実装をする必要がある</li>
</ul>
</li>
<li>出力のコードにモジュール構造が残らず JavaScript エンジンでの最適化に使うことができないので、パフォーマンスに悪影響が及ぶ可能性がある</li>
</ul>
<p>モジュールバンドラーは Module Fragments を使ったコードを出力にすることでこれらの問題を解決することができます。</p>
<p>手前味噌ですがこれについて解説する記事を書いたので気になる方はご覧ください。</p>
<p><a href="https://sosukesuzuki.dev/posts/stage-0-module-fragments/">https://sosukesuzuki.dev/posts/stage-0-module-fragments/</a></p>
<hr>
<h3 id="requesting-performance-isolation-with-the-origin-agent-cluster-header"><a href="https://web.dev/origin-agent-cluster/">Requesting performance isolation with the Origin-Agent-Cluster header</a></h3>
<ul>
<li>共有者: shisama_</li>
</ul>
<p>Site Isolation の Origin で Isolation するための機能の話です。
HTTP レスポンスヘッダとして<code>Origin-Agent-Cluster: ?1</code>を返すことで iframe で埋め込まれた Same-site cross-origin なページをプロセスレベルで分離することが可能になります。</p>
<p>たとえば、<code>https://mail.example.com</code> の中に iframe を使って <code>https://chat.example.com</code> が埋め込まれていたとします。
両者はサブドメインは違えど eTLD+1 は同じなので SameSite となります。Site Isolation は Same-site であればプロセスは 1 つのため、メモリ管理も同じプロセス内で行われます。</p>
<p>そのため、一方に XSS が埋め込まれてメモリにアクセスできれば、サイドチャネル攻撃により情報を盗まれる可能性があります。
Origin レベルで分離することで Same-site でも Cross-origin の場合でも一方に脆弱性があってももう一方への影響を防ぐことができます。
<code>Origin-Agent-Cluster</code> が有効になっている場合、次のことができなくなります。</p>
<ul>
<li>document.domain = “example.com” をしても何もしない。書き換えないだけで例外は投げない</li>
<li><code>postMessage()</code> による <code>WebAssembly.Module</code> を Cross-origin のページに送信できない</li>
<li><code>SharedArrayBuffer</code> や <code>WebAssembly.Memory</code> を Cross-origin のページに送信できない</li>
</ul>
<p>プロセスが同じだと iframe で埋め込んだページがリソースを使いまくっていた場合、埋め込み元のページにも影響していました。しかし、プロセスが分離されると、埋め込み元のことを気にしなくても良くなるといったパフォーマンスの改善にもつながります。<br>
埋め込み先が重くても埋め込み元は影響を受けない。<br>
ただ、パフォーマンスに関しても本当に速くなるのかは実際動かして確認したほうがいいとのことです。</p>
<p>ただし、<code>Origin-Agent-Cluster</code> はセキュリティに関する HTTP ヘッダではない、とこの記事には書かれています。次のような理由から origin-keyed agent cluster がセキュリティ機能として考えないほうがいいとされています。その代わり、リソースを分離することでブラウザにリソース割当の優先度決めを助長する方法として考えられます。</p>
<ul>
<li>Firefox や Safari では iframe ごとのプロセスの分離が実装されていない</li>
<li>リソースが限られている Android ではできるだけプロセスを増やさないようにしている
<ul>
<li>Site Isolation もパスワード画面など一部でしか適用されていない</li>
</ul>
</li>
<li>ブラウザはプロセスの分離ではなく、スレッドによる分離などを優先して利用するかもしれない</li>
<li>サイト全体ではなく一部のページにのみ <code>Origin-Agent-Cluster</code> が適用されていた場合、適用されていないページを踏むとブラウザはその Origin を origin keyed cluster としてみなさない</li>
</ul>
<details>
<summary><strong>その他参考文献</strong></summary>
<ul>
<li><a href="https://blog.jxck.io/entries/2020-05-22/site-isolation.html">Site Isolation 及び Web のセキュリティモデルの更新 | blog.jxck.io</a>
<ul>
<li>Site Isolation から Origin Isolation までの流れが紹介されています</li>
<li>それぞれの参考リンクが網羅的に紹介されています。</li>
</ul>
</li>
<li><a href="https://mozaic.fm/episodes/63/cross-origin-info-leaks.html">ep63 Cross Origin Info Leaks | mozaic.fm</a>
<ul>
<li>Origin Isolation については mozaic.fm ep63 00:55 ぐらいから解説されてました</li>
</ul>
</li>
<li><a href="https://github.com/whatwg/html/pull/6214">Rename <code>Origin-Isolation</code> to <code>Origin-Agent-Cluster</code> by domenic · Pull Request #6214 · whatwg/html</a>
<ul>
<li>元々 “Origin Isolation” という名前で仕様策定されていたので、調査するときは “Origin Isolation” で調べても良さそうです。</li>
</ul>
</li></ul></details>


<hr><h2 data-astro-cid-zlq3lpzk>フロントエンドエキスパートチームについて</h2><div class="wrapper" data-astro-cid-zlq3lpzk><script data-id="0efec8a9dd224baebfb2aaf30fbe9a28" data-ratio="1.33333333333333" src="//speakerdeck.com/assets/embed.js" class="speakerdeck-embed"></script></div><p data-astro-cid-zlq3lpzk><a href="https://speakerdeck.com/cybozuinsideout/frontendexpert-team" target="_blank" rel="nofollow noopener noreferrer" data-astro-cid-zlq3lpzk>https://speakerdeck.com/cybozuinsideout/frontendexpert-team</a></p></div></main><footer class="footer"><a href="/frontend-monthly/">Cybozu Frontend Monthly</a></footer></body></html>