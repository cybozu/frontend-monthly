---
title: Cybozu Frontend Monthly
date: "2021-05-25T17:00:00+09:00"
slug: "2021-05"
connpass: ""
streamUrl: ""
no: 11
members:
  - name: "@koba04"
    link: https://twitter.com/koba04
  - name: "@pirosikick"
    link: https://twitter.com/pirosikick
  - name: "@__sakito__"
    link: https://twitter.com/__sakito__
  - name: "@shisama_"
    link: https://twitter.com/shisama_
  - name: "@nakajmg"
    link: https://twitter.com/nakajmg
  - name: "@b4h0_c4t"
    link: https://twitter.com/b4h0_c4t
  - name: "@__sosukesuzuki"
    link: https://twitter.com/__sosukesuzuki
  - name: "@mugi_uno"
    link: https://twitter.com/mugi_uno
guest:
  - name: "@toshi__toma"
    link: https://twitter.com/toshi__toma
  - name: "holly"
    link: https://twitter.com/1013Youmeee
---

### [JWT should not be your default for sessions](https://evertpot.com/jwt-is-a-bad-default/)

- 共有者: mugi

従来のバックエンドでのセッション管理と比較した場合の、JWT でのセッション管理のリスクに関するブログ。

昔ながらのセッション管理ではスケールを考えるとバックエンド側に Redis や DB といったセッションデータ用の仕組みを持つことが多いが、JWT の場合はそれが不要でシンプルになり、よりスケーラブルであると言われているが、次のような問題があると言及している。

- JWT 自体が複雑な仕様(RFC7519)であること
  - 設定を間違える可能性がある
  - 初心者だから間違えるとはいえず、過去には Auth0 製品でも発生している
    https://insomniasec.com/blog/auth0-jwt-validation-bypass
- 何も対策しない場合にはバックエンド主導でログアウトさせる方法が無い
  - トークンのライフサイクルを短くする または 期限切れになったトークンのリストをバックエンドで保持することで解決できるが、元来 JWT のメリットであった「バックエンドの仕組みが不要」点は失われる
- JWT のサイズ自体が比較的大きいこと
  - リクエストのオーバーヘッドになりやすい

ブログ筆者が JWT に言及している 12 件ほどの記事とリポジトリを調べたところ、大半でログアウト手段を持っていない・バックエンドでのセッションと併用していて JWT 自体が不要・秘密鍵自体が同梱されちゃってた、といった状態だったらしく、正しく JWT を運用する難しさを改めて確認したとのこと。

JWT を利用することで、時によってはサービスをステートレス化することができ、理想的な選択になり得るが、従来のセッション管理と比較すると必ずもシンプルにはならず、より複雑なインフラが必要となる可能性もある。セキュリティと機能のトレードオフにも注意が必要。

記事の最後には「ボイラープレートやテンプレートからは JWT は外し、デフォルトの選択にしないでね」と締めくくってる。

以下は個人的な感想。

- 欠点として挙げられている「設定を間違えやすい」という点については、バックエンドでのセッション管理でも同じなので、JWT 固有ではないような気もした
- ただ、強制的にログアウトさせることができない & そのためにはバックエンドでデータを持つ必要がある、というのは納得感はあった
- JWT の RFC を改めて読んでおこうって思いました
