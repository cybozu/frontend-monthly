---
title: Cybozu Frontend Monthly
date: "2021-01-26T17:00:00+09:00"
connpass: ""
streamUrl: ""
no: 7
members:
  - name: "@koba04"
    link: https://twitter.com/koba04
  - name: "@pirosikick"
    link: https://twitter.com/pirosikick
  - name: "@toshi__toma"
    link: https://twitter.com/toshi__toma
  - name: "@zaki___yama"
    link: https://twitter.com/zaki___yama
  - name: "@__sakito__"
    link: https://twitter.com/__sakito__
  - name: "@shisama_"
    link: https://twitter.com/shisama_
  - name: "@nakajmg"
    link: https://twitter.com/nakajmg
  - name: "@b4h0_c4t"
    link: https://twitter.com/b4h0_c4t
  - name: "@__sosukesuzuki"
    link: https://twitter.com/__sosukesuzuki
guest:
---

### JavaScriptアンケート周り

- 共有者: @\_\_sakito\_\_

- [State of JS 2020](https://2020.stateofjs.com/en-US/)
  - [日本語訳](https://2020.stateofjs.com/ja-JP/)
- [2020 JavaScript Rising Stars](https://risingstars.js.org/2020/en)
  - [日本語訳](https://risingstars.js.org/2020/ja)

両方とも2020年の流れを把握するのに使えそうです。

State of JSは、ビルドがesbuildやsbowpack、フレームワークは引き続きsvelteに興味持ってる人が多かったです。
しかし実際に使用してるものは、webpackなどになっており、新しいものはまだプロダクションで使用するには踏み込めない印象。
各項目で色々な人が2020年の個人的ベストを紹介してるのが面白かった、[changesets](https://github.com/atlassian/changesets)、[Insomnia](https://insomnia.rest/)、[Redwood](https://redwoodjs.com/)など知らないものを知れました。

2020 JavaScript Rising Starsは、あくまでスター数なのでState of JS 2020と見比べて世間がどこに注目しているか照らし合わせるとよさそうです。
各セクションで説明もあるので、なぜスター数が増えたのかもわかりやすいです。

---

### [Don’t Use Inverted Color Cues on Toggle Buttons](https://uxmovement.com/buttons/dont-use-inverted-color-cues-on-toggle-buttons/)

- 共有者: @pirosikick

トグルボタンでボタンの文字色と背景色を反転させたON・OFFボタンを作りがちだが、
色のコントラスト比が同じになるのでどちらがONでOFFなのかわからず誤操作が増えがちなので気をつけなはれや、という内容。
ブログの画像を見ると分かりやすいですが、色の反転の代わりに奥行きでON/OFFを表現するといいよとのことです。
最近、tailwind.cssを使っていて悪い例と同じようなことをしていたので、タイムリーで参考になりました。


### [Classiにフロントエンドエキスパートチームを作った話](https://tech.classi.jp/entry/2021/01/18/103110)

- 共有者: @nakajmg

Classiさんがフロントエンドエキスパートチームを作った話。
弊チームを参考にしてくれたとのことで、私達の活動が界隈に影響を与えられていると思うと嬉しいですね。

記事中では[FrontendOps](https://giamir.com/frontendops)について触れており、フロントエンドの運用が開発者だけの関心事ではなく、チーム全員にとって重要であると説明しています。
今後ますますフロントエンドの運用は重要な関心事となっていくと思いますので、弊フロントエンドエキスパートチームとしても真摯に向き合って行きたいです。

---

### [Front-End Performance Checklist 2021 — Smashing Magazine](https://www.smashingmagazine.com/2021/01/front-end-performance-2021-free-pdf-checklist/)

- 共有者: @shisama

パフォーマンスに関するチェックリストです。  
77個のチェックリストがありますが、長大なので挫折しそうな人はサマライズされている [PDF版](https://www.dropbox.com/s/34noajrbm324iai/performance-checklist-1.4.pdf) を読んでみて気になるところは記事の方を読んでみるのが良いかと思います。  

記事の最後には**Quic Wins**として1時間で改善できる17個のことを記事中からピックアップされているので、まずはこれからはじめるのも良さそうです。  
個人的には「パフォーマンスの文化を作る」が最初に来ているところがいいと思いました。  

パフォーマンスに関連する話で今月知ったものもあわせて紹介しておきます。

この記事の中でもCoreWebVitalsを使って計測する話があり、DevTools で計測したり、[Chrome拡張](https://chrome.google.com/webstore/detail/web-vitals/ahfhijdlegdabablpippeagghigmibma?hl=en)を使っている人が多いと思いますが、Chrome 90からはExperimentalですがChrome本体でもメトリクスを常に監視できるようになるようです。  
[AddyOsmani.com - A Performance Heads-Up Display (HUD) for Chrome](https://addyosmani.com/blog/performance-hud/)

JSのサイズについては、モダンブラウザで使えるJSの構文を使うことでバンドルサイズを減らせると紹介されています。  
JSのネイティブに置き換えることでどれくらいバンドルサイズを減らせるかをチェックするツールがあるので、試してみるといいかもしれません。   
[EStimator.dev: the modern JavaScript savings calculator](https://estimator.dev/)

---

### [Agenda for the 80th meeting of Ecma TC39](https://github.com/tc39/agendas/blob/master/2021/01.md)

TC39 の１月のミーティングのアジェンダです。25日~28日にかけて行われます。

このミーティングでは多くのプロポーザルについての議論が行われる予定です。

#### [Intl系(ECMA402)](https://github.com/tc39/ecma402)のプロポーザル

- [Intl.DateTimeFormat.prototype.formatRange](https://github.com/tc39/proposal-intl-DateTimeFormat-formatRange) for Stage 4
- [Intl Locale Info](https://github.com/tc39/proposal-intl-locale-info) for stage 2
- [Intl DisplayNames](https://github.com/tc39/intl-displaynames-v2) v2 for stage 2
- [eraDisplay option for Intl.DateTimeFormat](https://github.com/Louis-Aime/proposal-intl-eradisplay) for stage 1
- [Intl LocaleMatcher](https://github.com/longlho/proposal-intl-localematcher) for Stage 1
- [Extend TimeZoneName Option Proposal](https://github.com/FrankYFTang/proposal-intl-extend-timezonename/) for stage 1

#### 新しい構文を追加するプロポーザル

- ⭐[Class static Initialization Blocks](https://github.com/tc39/proposal-class-static-block) for Stage 3
- ⭐[JS Module Blocks](https://github.com/tc39/proposal-json-modules) for stage 2
- ⭐[do expressions](https://github.com/bakkot/do-expressions-v2) for stage 2
- [async do expressions](https://github.com/bakkot/proposal-async-do-expressions) for stage 1
- [Adopting Unicode behavior for set notation in regular expressions](https://github.com/mathiasbynens/proposal-regexp-set-notation)
- ⭐[defer module import eval](https://github.com/codehag/proposal-lazy-import) for stage 1

#### 新しい API を追加するプロポーザル

- ⭐[Relative indexing method](https://github.com/tc39/proposal-relative-indexing-method) for stage 4
- [Array.isTemplateObject](https://github.com/tc39/proposal-array-is-template-object) for stage 3
- ⭐[Temporal](https://github.com/tc39/proposal-temporal) updates
- [ResizableArrayBuffer and GrowableSharedArrayBuffer](https://github.com/tc39/proposal-resizablearraybuffer) updates
- ⭐[Realms](https://github.com/tc39/proposal-realms) update
- [Array find from last](https://github.com/Kingwl/proposal-array-find-from-last) for stage 1

#### その他
- [Ergonomic brand checks for private fields](https://github.com/tc39/proposal-private-fields-in-in) for stage 3
- [Dynamic code brand checks](https://github.com/tc39/proposal-dynamic-code-brand-checks) for stage 2
- [class brand check](https://github.com/hax/proposal-class-brand-check) for stage 1
- ⭐[JSON modules](https://github.com/tc39/proposal-json-modules) for stage 3
- [RegExp Match Indices](https://github.com/tc39/proposal-regexp-match-indices) update

---

### [Enabling Popups - MicrosoftEdge/MSEdgeExplainers](https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md)

- 共有者: @zaki___yama

[以前のFrontend Monthly](https://cybozu.github.io/frontend-monthly/posts/2020-08)で "[Enabling Custom Control UI](https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/ControlUICustomization/explainer.md)" というプロポーザルを紹介したんですが、その続編みたいなプロポーザルです。
といってもその後の動向を熱心にウォッチしてたわけではなく、例によって Edge のPMの[ツイート](https://twitter.com/soMelanieSaid/status/1352324867941568512?s=20) から知りました。

#### 概要
- `<popup>` という新しいHTML要素の提案です
- 他のHTML要素と同じようにマークアップを書き、 `show()/hide()` メソッドで表示／非表示を制御します

```html
<button aria-haspopup="true" aria-controls="menuPopup" id="menuButton">Menu</button>
<popup id="menuPopup" role="menu" anchor="menuButton">
    <!-- Markup for menuitems goes here -->
</popup>
```

```javascript
document.getElementById('menuButton').addEventListener('click', () => {
  document.getElementById('menuPopup').show()
})
```

- `popup` は独立した要素の可能性もあるし、comboboxのようなより大きな複合的な(composited)コンポーネントの一部の可能性もあります

#### 面白いと思ったポイントいくつか
- popup は以下の挙動をする。これらの挙動をプロポーザル中では "light dismiss" と表現している
    - ユーザーがEscapeキーを押した
    - `popup` またはそのアンカー要素のlayoutが変更された
    - フォーカスが外れた
- [[Anchored positioning](https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#anchored-positioning)] popup の位置を他の要素に紐付けられるよう、CSS anchored positioning scheme という別のプロポーザルも策定予定。ただ現状も `anchor` 属性を指定すると別の要素に紐付けることができる
- [[Alternate Solutions Considered](https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#alternate-solutions-considered)] 別のソリューションとして `<dialog>` 要素の拡張も考えたけど、popupとdialogで期待する機能が違うのでやめた。たとえば
    - popup は軽量なUIで、ユーザーが他のUIを操作したときなどに自動的に消えてほしいけど、dialog は一般的にユーザーが明示的に閉じないと消えない
    - popup は一度に1つしか表示できないが、dialog はそうとは限らない
    - dialog を表示したとき popup は非表示になるべきだけど、逆はそうとは限らない
- [[Areas for exploration](https://github.com/MicrosoftEdge/MSEdgeExplainers/blob/main/Popup/explainer.md#areas-for-exploration)] 表示・非表示を手続き的に書かないといけないのかーと思ったけど、宣言的に書けるような属性も検討するかも

### [How We Improved SmashingMag Performance](https://www.smashingmagazine.com/2021/01/smashingmag-performance-case-study/)

- 共有者: @b4h0-c4t

#### 一行まとめ

JAMStack上でReactを使って構築したWebサイトのパフォーマンスを最適化し、Core Web Vitalsのメトリクスを改善した手法の話。

#### 序文

Webパフォーマンスについての話の多くはオーバーホールから始まる。
一方で、時間経過による機能追加の結果コードの断片化やサードパーティスクリプトの読み込み高速化のための "fourth-party" スクリプトが入ってしまう。

実際、smashing社もパフォーマンスへの目標をしばしば忘れていた結果、Lighthouseスコアがボロボロになっていた。

#### That’s Where We Were

対象サービス(おそらくブログ)はJAMStack上でHugo + Reactを用いて構築されている。
記事のビルドには6分近く掛かり、CSSの注入、Webpackのコード分割、広告・昨日の動的挿入RSS生成、エッジに配信するためのABテスト等のビルドプロセスが走っていた。

#### Identifying Bottlenecks

ボトルネックを特定するためにいくつかのパフォーマンス評価を実施した。

LCPの結果、5-9月あたりからパフォーマンスの悪化が見られた。
この時期はナビゲーションバーのリリースを実施していたことから、この指標からボトルネックを特定するのは容易だった。

サービスのリクエストマップを調べた当初は特に問題はなさそうだった。
しかし、特定の条件下でDOMのサイズが爆発的に大きくなることを発見した。
主要なページのみを計測対象とした結果発見できていなかったが、埋め込み等が多く用いられている記事を計測した際は膨大なリクエストが行き来していることがわかった。

#### やったこと

- headの読み込み順序改善
- 特に重要なCSSの手動生成
- Webフォントの読込変更
- モノリシックなJSの特定と分解
- サードパーティコンテンツの適切な割り当て(レイアウト)
- 体験の向上(AVIF生成や著作画像のプリロード等)

#### どうなったか

- Lighthouseのスコアはかなり改善した。
インタラクティブタイムとブロッキングタイムが今後の課題で、CSSサイズの縮小やモバイル用のバンドルも検討している。